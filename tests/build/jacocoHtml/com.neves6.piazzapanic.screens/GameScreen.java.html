<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GameScreen.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">tests</a> &gt; <a href="index.source.html" class="el_package">com.neves6.piazzapanic.screens</a> &gt; <span class="el_source">GameScreen.java</span></div><h1>GameScreen.java</h1><pre class="source lang-java linenums">package com.neves6.piazzapanic.screens;

import com.badlogic.gdx.*;
import com.badlogic.gdx.graphics.GL20;
import com.badlogic.gdx.graphics.OrthographicCamera;
import com.badlogic.gdx.graphics.Texture;
import com.badlogic.gdx.graphics.g2d.BitmapFont;
import com.badlogic.gdx.graphics.g2d.SpriteBatch;
import com.badlogic.gdx.maps.tiled.TiledMap;
import com.badlogic.gdx.maps.tiled.TmxMapLoader;
import com.badlogic.gdx.maps.tiled.renderers.OrthogonalTiledMapRenderer;
import com.neves6.piazzapanic.gamemaster.ScenarioGameMaster;
import com.neves6.piazzapanic.gamemechanisms.GameReader;
import com.neves6.piazzapanic.gamemechanisms.Money;
import com.neves6.piazzapanic.staff.BaseStaff;
import com.neves6.piazzapanic.staff.DeliveryStaff;
import com.neves6.piazzapanic.staff.IngredientsStaff;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Arrays;
import org.json.simple.parser.ParseException;

/** A screen that displays the main game. */
public class GameScreen extends ScreenAdapter implements InputProcessor {
  DeliveryStaff deliveryStaff;
  PiazzaPanicGame game;
  OrthographicCamera camera;
  SpriteBatch batch;
  BitmapFont font;
  int winWidth;
  int winHeight;
  TiledMap map;
  OrthogonalTiledMapRenderer renderer;
  ScenarioGameMaster gm;
  float unitScale;
  float wScale;
  float hScale;
  int INITIAL_WIDTH;
  int INITIAL_HEIGHT;
<span class="pc" id="L40">  int[] renderableLayers = {0, 1, 2};</span>
  Texture selectedTexture;
  Texture recipes;
  Texture lock;
  Money machineUnlockBalance;
  IngredientsStaff ingredientsHelper;

  /**
   * Constructor method.
   *
   * @param game Instance of PiazzaPanicGame used to control screen transitions.
   * @param level The difficulty that the user has selected.
   */
<span class="fc" id="L53">  public GameScreen(PiazzaPanicGame game, int level, boolean scenerio, boolean disablePowerup) {</span>
<span class="fc" id="L54">    sharedSetup();</span>
<span class="fc" id="L55">    this.game = game;</span>
<span class="fc bfc" id="L56" title="All 2 branches covered.">    if (level == 1) {</span>
<span class="fc" id="L57">      map = new TmxMapLoader().load(&quot;tilemaps/level1.tmx&quot;);</span>
<span class="pc bpc" id="L58" title="1 of 2 branches missed.">      if (scenerio) {</span>
<span class="nc" id="L59">        gm =</span>
            new ScenarioGameMaster(
                game,
                map,
                3,
                5,
                machineUnlockBalance,
                ingredientsHelper,
                deliveryStaff,
<span class="nc" id="L68">                disablePowerup,</span>
                level);
      } else {
<span class="fc" id="L71">        gm =</span>
            new ScenarioGameMaster(
                game,
                map,
                3,
                -1,
                machineUnlockBalance,
                ingredientsHelper,
                deliveryStaff,
<span class="fc" id="L80">                disablePowerup,</span>
                level);
      }
    }
<span class="fc" id="L84">  }</span>

<span class="nc" id="L86">  public GameScreen(PiazzaPanicGame game) throws ParseException {</span>
<span class="nc" id="L87">    sharedSetup();</span>
<span class="nc" id="L88">    this.game = game;</span>
<span class="nc" id="L89">    GameReader gr = null;</span>
    try {
<span class="nc" id="L91">      gr = new GameReader(&quot;here.json&quot;);</span>
<span class="nc" id="L92">    } catch (IOException e) {</span>
<span class="nc" id="L93">      throw new RuntimeException(e);</span>
<span class="nc" id="L94">    }</span>
<span class="nc" id="L95">    map = new TmxMapLoader().load(&quot;tilemaps/level1.tmx&quot;);</span>
<span class="nc" id="L96">    gm = gr.createGameMaster(game, map, machineUnlockBalance, ingredientsHelper, deliveryStaff);</span>
<span class="nc" id="L97">  }</span>

  public void sharedSetup() {
<span class="fc" id="L100">    font = new BitmapFont(Gdx.files.internal(&quot;fonts/IBM_Plex_Mono_SemiBold_Black.fnt&quot;));</span>
<span class="fc" id="L101">    font.getData().setScale(0.75F);</span>
<span class="fc" id="L102">    this.INITIAL_WIDTH = Gdx.graphics.getWidth();</span>
<span class="fc" id="L103">    this.INITIAL_HEIGHT = Gdx.graphics.getHeight();</span>
<span class="fc" id="L104">    this.machineUnlockBalance = new Money();</span>
<span class="fc" id="L105">    this.deliveryStaff =</span>
        new DeliveryStaff(
<span class="fc" id="L107">            new ArrayList&lt;&gt;(Arrays.asList(3, 4, 5, 6, 7, 8)),</span>
<span class="fc" id="L108">            (new ArrayList&lt;&gt;(Arrays.asList(4, 4, 4, 4, 4, 4))));</span>
<span class="fc" id="L109">    this.ingredientsHelper =</span>
        new IngredientsStaff(
<span class="fc" id="L111">            new ArrayList&lt;&gt;(Arrays.asList(7, 6, 5, 4, 3, 2, 1, 2, 2, 2)),</span>
<span class="fc" id="L112">            (new ArrayList&lt;&gt;(Arrays.asList(9, 9, 9, 9, 9, 9, 9, 9, 8, 9))));</span>
<span class="fc" id="L113">    selectedTexture = new Texture(Gdx.files.internal(&quot;people/selected.png&quot;));</span>
<span class="fc" id="L114">    recipes = new Texture(Gdx.files.internal(&quot;recipes.png&quot;));</span>
<span class="fc" id="L115">    lock = new Texture(Gdx.files.internal(&quot;levellocked.png&quot;));</span>
<span class="fc" id="L116">    unitScale = Gdx.graphics.getHeight() / (12f * 32f);</span>
<span class="fc" id="L117">    wScale = unitScale * 32f;</span>
<span class="fc" id="L118">    hScale = unitScale * 32f;</span>
<span class="fc" id="L119">  }</span>

  /** What to show when this screen is loaded. */
  @Override
  public void show() {
<span class="fc" id="L124">    camera = new OrthographicCamera();</span>
<span class="fc" id="L125">    camera.setToOrtho(false, Gdx.graphics.getWidth(), Gdx.graphics.getHeight());</span>

<span class="fc" id="L127">    Gdx.graphics.setResizable(false);</span>

<span class="fc" id="L129">    Gdx.input.setInputProcessor(this);</span>
<span class="fc" id="L130">  }</span>

  /**
   * What to process in every frame.
   *
   * @param delta The time in seconds since the last render.
   */
  @Override
  public void render(float delta) {
<span class="nc" id="L139">    gm.tickUpdate(delta);</span>

<span class="nc" id="L141">    gm.setRecipeToStaff();</span>

<span class="nc" id="L143">    Gdx.gl20.glViewport(0, 0, Gdx.graphics.getWidth(), Gdx.graphics.getHeight());</span>
<span class="nc" id="L144">    Gdx.gl.glClear(GL20.GL_COLOR_BUFFER_BIT);</span>

<span class="nc" id="L146">    winWidth = Gdx.graphics.getWidth();</span>
<span class="nc" id="L147">    winHeight = Gdx.graphics.getHeight();</span>

<span class="nc" id="L149">    camera.update();</span>
    // game.batch.setProjectionMatrix(camera.combined);

<span class="nc" id="L152">    renderer.setView(camera);</span>
<span class="nc" id="L153">    renderer.render(renderableLayers);</span>

<span class="nc" id="L155">    game.getBatch().begin();</span>
<span class="nc" id="L156">    game.getBatch()</span>
<span class="nc" id="L157">        .draw(</span>
<span class="nc" id="L158">            gm.getChef(1).getTxNow(),</span>
<span class="nc" id="L159">            gm.getChef(1).getxCoord() * wScale,</span>
<span class="nc" id="L160">            gm.getChef(1).getyCoord() * hScale,</span>
            32 * unitScale,
            32 * unitScale);
<span class="nc" id="L163">    game.getBatch()</span>
<span class="nc" id="L164">        .draw(</span>
<span class="nc" id="L165">            gm.getChef(2).getTxNow(),</span>
<span class="nc" id="L166">            gm.getChef(2).getxCoord() * wScale,</span>
<span class="nc" id="L167">            gm.getChef(2).getyCoord() * hScale,</span>
            32 * unitScale,
            32 * unitScale);
<span class="nc" id="L170">    game.getBatch()</span>
<span class="nc" id="L171">        .draw(</span>
<span class="nc" id="L172">            gm.getChef(3).getTxNow(),</span>
<span class="nc" id="L173">            gm.getChef(3).getxCoord() * wScale,</span>
<span class="nc" id="L174">            gm.getChef(3).getyCoord() * hScale,</span>
            32 * unitScale,
            32 * unitScale);
<span class="nc" id="L177">    game.getBatch()</span>
<span class="nc" id="L178">        .draw(</span>
            selectedTexture,
<span class="nc" id="L180">            gm.getChef(gm.getSelectedChef()).getxCoord() * wScale,</span>
<span class="nc" id="L181">            gm.getChef(gm.getSelectedChef()).getyCoord() * hScale,</span>
            32 * unitScale,
            32 * unitScale);

<span class="nc bnc" id="L185" title="All 2 branches missed.">    if (gm.getCustomersRemaining() &gt;= 1) {</span>
<span class="nc" id="L186">      game.getBatch()</span>
<span class="nc" id="L187">          .draw(</span>
<span class="nc" id="L188">              gm.getFirstCustomer().getTxUp(),</span>
              8 * wScale,
              2 * hScale,
              32 * unitScale,
              32 * unitScale);
<span class="nc bnc" id="L193" title="All 2 branches missed.">      for (int i = 1; i &lt; gm.getCustomersRemaining(); i++) {</span>
<span class="nc" id="L194">        game.getBatch()</span>
<span class="nc" id="L195">            .draw(</span>
<span class="nc" id="L196">                gm.getFirstCustomer().getTxLeft(),</span>
                (8 + i) * wScale,
                2 * hScale,
                32 * unitScale,
                32 * unitScale);
      }
    }
<span class="nc" id="L203">    font.draw(</span>
<span class="nc" id="L204">        game.getBatch(),</span>
<span class="nc" id="L205">        gm.getMachineTimerForChef(0),</span>
<span class="nc" id="L206">        gm.getChef(1).getxCoord() * wScale,</span>
<span class="nc" id="L207">        gm.getChef(1).getyCoord() * hScale + 2 * (hScale / 3f),</span>
        32 * unitScale,
        1,
        true);
<span class="nc" id="L211">    font.draw(</span>
<span class="nc" id="L212">        game.getBatch(),</span>
<span class="nc" id="L213">        gm.getMachineTimerForChef(1),</span>
<span class="nc" id="L214">        gm.getChef(2).getxCoord() * wScale,</span>
<span class="nc" id="L215">        gm.getChef(2).getyCoord() * hScale + 2 * (hScale / 3f),</span>
        32 * unitScale,
        1,
        true);
<span class="nc" id="L219">    game.getBatch().draw(recipes, 20, 20);</span>
<span class="nc" id="L220">    font.draw(</span>
<span class="nc" id="L221">        game.getBatch(),</span>
<span class="nc" id="L222">        gm.generateHoldingsText(),</span>
        winWidth - (4.75f * (winWidth / 8f)),
        winHeight - 20,
        (3 * (winWidth / 8f)),
        -1,
        true);
<span class="nc" id="L228">    font.draw(</span>
<span class="nc" id="L229">        game.getBatch(),</span>
<span class="nc" id="L230">        gm.generateCustomersTrayText(),</span>
        winWidth - (3 * (winWidth / 8f)),
        winHeight - 20,
        (3 * (winWidth / 8f)),
        -1,
        true);
<span class="nc" id="L236">    font.draw(</span>
<span class="nc" id="L237">        game.getBatch(),</span>
<span class="nc" id="L238">        gm.generateTimerText(),</span>
        winWidth - (winWidth / 3f),
        40,
        (winWidth / 3f),
        -1,
        true);
<span class="nc" id="L244">    font.draw(</span>
<span class="nc" id="L245">        game.getBatch(),</span>
<span class="nc" id="L246">        gm.generateReputationPointText(),</span>
        winWidth - (winWidth / 3f),
        60,
        (winWidth / 3f),
        -1,
        true);
<span class="nc" id="L252">    font.draw(</span>
<span class="nc" id="L253">        game.getBatch(),</span>
<span class="nc" id="L254">        machineUnlockBalance.displayBalance(),</span>
        winWidth - (winWidth / 3f),
        80,
        (winWidth / 3f),
        -1,
        true);
<span class="nc" id="L260">    font.draw(</span>
<span class="nc" id="L261">        game.getBatch(),</span>
<span class="nc" id="L262">        gm.getPowerUpRunner().displayText(),</span>
        winWidth - (winWidth / 3f),
        550,
        (winWidth / 3f),
        -1,
        true);

    // Any machines that are unlockable add here to draw a lock on top of it.
<span class="nc bnc" id="L270" title="All 2 branches missed.">    if (!(machineUnlockBalance.isUnlocked(&quot;chopping&quot;))) {</span>
<span class="nc" id="L271">      game.getBatch().draw(lock, 12 * wScale, 7 * hScale, 32 * unitScale, 32 * unitScale);</span>
    }
<span class="nc bnc" id="L273" title="All 2 branches missed.">    if (!(machineUnlockBalance.isUnlocked(&quot;forming&quot;))) {</span>
<span class="nc" id="L274">      game.getBatch().draw(lock, 10 * wScale, 7 * hScale, 32 * unitScale, 32 * unitScale);</span>
    }
<span class="nc bnc" id="L276" title="All 2 branches missed.">    if (!(machineUnlockBalance.isUnlocked(&quot;grill&quot;))) {</span>
<span class="nc" id="L277">      game.getBatch().draw(lock, 7 * wScale, 7 * hScale, 32 * unitScale, 32 * unitScale);</span>
    }
<span class="nc bnc" id="L279" title="All 2 branches missed.">    if (!(machineUnlockBalance.isUnlocked(&quot;potato&quot;))) {</span>
<span class="nc" id="L280">      game.getBatch().draw(lock, 14 * wScale, 6 * hScale, 32 * unitScale, 32 * unitScale);</span>
    }
<span class="nc bnc" id="L282" title="All 2 branches missed.">    if (!(machineUnlockBalance.isUnlocked(&quot;pizza&quot;))) {</span>
<span class="nc" id="L283">      game.getBatch().draw(lock, 1 * wScale, 6 * hScale, 32 * unitScale, 32 * unitScale);</span>
    }
<span class="nc bnc" id="L285" title="All 2 branches missed.">    if (!(machineUnlockBalance.isUnlocked(&quot;ingredients-staff&quot;))) {</span>
<span class="nc" id="L286">      game.getBatch().draw(lock, 2 * wScale, 7 * hScale, 32 * unitScale, 32 * unitScale);</span>
    }
<span class="nc bnc" id="L288" title="All 2 branches missed.">    if (!(machineUnlockBalance.isUnlocked(&quot;server-staff&quot;))) {</span>
<span class="nc" id="L289">      game.getBatch().draw(lock, 1 * wScale, 3 * hScale, 32 * unitScale, 32 * unitScale);</span>
    }

<span class="nc" id="L292">    game.getBatch().end();</span>

<span class="nc" id="L294">    drawSequence(ingredientsHelper);</span>
<span class="nc" id="L295">    drawSequence(deliveryStaff);</span>
<span class="nc" id="L296">  }</span>

  /**
   * Gets a pair of coordinates and draws a chef.
   *
   * @param ob A baseStaff object type which path is getting drawn.
   */
  public void drawSequence(BaseStaff ob) {
<span class="nc bnc" id="L304" title="All 2 branches missed.">    if (ob.getCollect()) {</span>
<span class="nc" id="L305">      ArrayList&lt;Integer&gt; pairCoord = ob.getCoordInSeq();</span>
<span class="nc" id="L306">      game.getBatch().begin();</span>
<span class="nc" id="L307">      game.getBatch()</span>
<span class="nc" id="L308">          .draw(</span>
<span class="nc" id="L309">              new Texture(Gdx.files.internal(&quot;people/chef1down.png&quot;)),</span>
<span class="nc" id="L310">              pairCoord.get(0) * wScale,</span>
<span class="nc" id="L311">              pairCoord.get(1) * hScale,</span>
              32 * unitScale,
              32 * unitScale);
<span class="nc" id="L314">      game.getBatch().end();</span>
    }
<span class="nc" id="L316">  }</span>

  /**
   * Changes size of input upon user adjustment.
   *
   * @param width Integer representing the horizontal size of the screen.
   * @param height Integer representing the vertical size of the screen.
   */
  @Override
  public void resize(int width, int height) {
<span class="pc bpc" id="L326" title="1 of 2 branches missed.">    if (game.testMode) {</span>
<span class="fc" id="L327">      return;</span>
    }

<span class="nc bnc" id="L330" title="All 4 branches missed.">    if (width == INITIAL_WIDTH &amp;&amp; height == INITIAL_HEIGHT) {</span>
<span class="nc" id="L331">      super.resize(width, height);</span>
<span class="nc" id="L332">      camera.setToOrtho(false, width, height);</span>
<span class="nc" id="L333">      unitScale = Gdx.graphics.getHeight() / (12f * 32f);</span>
<span class="nc" id="L334">      wScale = unitScale * 32f;</span>
<span class="nc" id="L335">      hScale = unitScale * 32f;</span>
<span class="nc" id="L336">      renderer = new OrthogonalTiledMapRenderer(map, unitScale);</span>
    } else {
<span class="nc" id="L338">      Gdx.graphics.setWindowedMode(INITIAL_WIDTH, INITIAL_HEIGHT);</span>
    }
<span class="nc" id="L340">  }</span>

  /** Method which runs when the screen transitions to another. */
  @Override
  public void hide() {
<span class="nc" id="L345">    super.dispose();</span>
<span class="nc" id="L346">    game.dispose();</span>
<span class="nc" id="L347">    font.dispose();</span>
<span class="nc" id="L348">    map.dispose();</span>
<span class="nc" id="L349">    renderer.dispose();</span>
<span class="nc" id="L350">    selectedTexture.dispose();</span>
<span class="nc" id="L351">    recipes.dispose();</span>
<span class="nc" id="L352">  }</span>

  /**
   * Getter method for scenario game master.
   *
   * @return Instance of scenario game master which is currently being used to control the game.
   */
  public ScenarioGameMaster getGameMaster() {
<span class="fc" id="L360">    return gm;</span>
  }

  /**
   * Method which runs when user presses a key down.
   *
   * @param keycode one of the constants in Input.Keys
   * @return true
   */
  @Override
  public boolean keyDown(int keycode) {
<span class="fc bfc" id="L371" title="All 2 branches covered.">    if (keycode == Input.Keys.W) {</span>
<span class="fc" id="L372">      gm.tryMove(&quot;up&quot;);</span>
    }
<span class="pc bpc" id="L374" title="1 of 2 branches missed.">    if (keycode == Input.Keys.A) {</span>
<span class="nc" id="L375">      gm.tryMove(&quot;left&quot;);</span>
    }
<span class="fc bfc" id="L377" title="All 2 branches covered.">    if (keycode == Input.Keys.S) {</span>
<span class="fc" id="L378">      gm.tryMove(&quot;down&quot;);</span>
    }
<span class="fc bfc" id="L380" title="All 2 branches covered.">    if (keycode == Input.Keys.D) {</span>
<span class="fc" id="L381">      gm.tryMove(&quot;right&quot;);</span>
    }
<span class="fc bfc" id="L383" title="All 2 branches covered.">    if (keycode == Input.Keys.NUM_1) {</span>
<span class="fc" id="L384">      gm.setSelectedChef(1);</span>
    }
<span class="fc bfc" id="L386" title="All 2 branches covered.">    if (keycode == Input.Keys.NUM_2) {</span>
<span class="fc" id="L387">      gm.setSelectedChef(2);</span>
    }
<span class="fc bfc" id="L389" title="All 2 branches covered.">    if (keycode == Input.Keys.NUM_3) {</span>
<span class="fc" id="L390">      gm.setSelectedChef(3);</span>
    }
<span class="pc bpc" id="L392" title="1 of 2 branches missed.">    if (keycode == Input.Keys.E) {</span>
<span class="nc" id="L393">      gm.tryInteract();</span>
    }
<span class="pc bpc" id="L395" title="1 of 2 branches missed.">    if (keycode == Input.Keys.ESCAPE) {</span>
      try {
<span class="nc" id="L397">        gm.getSave().closeClass();</span>
<span class="nc" id="L398">        game.setScreen(new IntroScreen(game));</span>
<span class="nc" id="L399">      } catch (IOException e) {</span>
<span class="nc" id="L400">        throw new RuntimeException(e);</span>
<span class="nc" id="L401">      }</span>
    }
<span class="fc" id="L403">    return true;</span>
  }

  /**
   * UNUSED METHOD
   *
   * @param keycode one of the constants in {@link Input.Keys}
   * @return false
   */
  @Override
  public boolean keyUp(int keycode) {
<span class="nc" id="L414">    return false;</span>
  }

  /**
   * UNUSED METHOD
   *
   * @param character The character
   * @return false
   */
  @Override
  public boolean keyTyped(char character) {
<span class="nc" id="L425">    return false;</span>
  }

  /**
   * UNUSED METHOD
   *
   * @param screenX The x coordinate, origin is in the upper left corner
   * @param screenY The y coordinate, origin is in the upper left corner
   * @param pointer the pointer for the event.
   * @param button the button
   * @return false
   */
  @Override
  public boolean touchDown(int screenX, int screenY, int pointer, int button) {
<span class="nc" id="L439">    return false;</span>
  }

  /**
   * UNUSED METHOD
   *
   * @param screenX
   * @param screenY
   * @param pointer the pointer for the event.
   * @param button the button
   * @return false
   */
  @Override
  public boolean touchUp(int screenX, int screenY, int pointer, int button) {
<span class="nc" id="L453">    return false;</span>
  }

  /**
   * UNUSED METHOD
   *
   * @param screenX
   * @param screenY
   * @param pointer the pointer for the event.
   * @return false
   */
  @Override
  public boolean touchDragged(int screenX, int screenY, int pointer) {
<span class="nc" id="L466">    return false;</span>
  }

  /**
   * UNUSED METHOD
   *
   * @param screenX
   * @param screenY
   * @return false
   */
  @Override
  public boolean mouseMoved(int screenX, int screenY) {
<span class="nc" id="L478">    return false;</span>
  }

  /**
   * UNUSED METHOD
   *
   * @param amountX the horizontal scroll amount, negative or positive depending on the direction
   *     the wheel was scrolled.
   * @param amountY the vertical scroll amount, negative or positive depending on the direction the
   *     wheel was scrolled.
   * @return false
   */
  @Override
  public boolean scrolled(float amountX, float amountY) {
<span class="nc" id="L492">    return false;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>