<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ScenarioGameMaster.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">tests</a> &gt; <a href="index.source.html" class="el_package">com.neves6.piazzapanic.gamemaster</a> &gt; <span class="el_source">ScenarioGameMaster.java</span></div><h1>ScenarioGameMaster.java</h1><pre class="source lang-java linenums">package com.neves6.piazzapanic.gamemaster;

import static com.neves6.piazzapanic.gamemechanisms.OrderMaster.checkOrderExpired;
import static com.neves6.piazzapanic.gamemechanisms.OrderMaster.createCustomers;
import static java.util.Arrays.asList;

import com.badlogic.gdx.Gdx;
import com.badlogic.gdx.audio.Sound;
import com.badlogic.gdx.maps.MapObject;
import com.badlogic.gdx.maps.MapObjects;
import com.badlogic.gdx.maps.tiled.TiledMap;
import com.badlogic.gdx.maps.tiled.TiledMapTileLayer;
import com.neves6.piazzapanic.gamemechanisms.*;
import com.neves6.piazzapanic.people.Chef;
import com.neves6.piazzapanic.people.Customer;
import com.neves6.piazzapanic.powerups.PowerUpRunner;
import com.neves6.piazzapanic.screens.GameWinScreen;
import com.neves6.piazzapanic.screens.PiazzaPanicGame;
import com.neves6.piazzapanic.staff.DeliveryStaff;
import com.neves6.piazzapanic.staff.IngredientsStaff;
import java.util.*;

/** A class designed to handle all in game processing. */
public class ScenarioGameMaster {
  DeliveryStaff deliveryStaff;
  IngredientsStaff staffOne;
  PiazzaPanicGame game;
  TiledMapMaster map;
  TiledMapTileLayer collisionLayer;
<span class="fc" id="L30">  ArrayList&lt;Chef&gt; chefs = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L31">  Queue&lt;Customer&gt; customers = new LinkedList&lt;&gt;();</span>
<span class="fc" id="L32">  Map&lt;String, Machine&gt; machines = new HashMap();</span>
<span class="fc" id="L33">  Tray tray1 = new Tray();</span>
<span class="fc" id="L34">  Tray tray2 = new Tray();</span>
  int selectedChef;
  float totalTimer;
  Sound grill;
  Sound chopping;
  Sound serving;
  Sound fridge;
  Sound forming;
  Sound trash;
  float soundVolume;
  ArrayList&lt;String&gt; settings;
  Money machineUnlockBalance;
<span class="fc" id="L46">  ArrayList&lt;String&gt; recipes =</span>
<span class="fc" id="L47">      new ArrayList&lt;&gt;(asList(&quot;salad&quot;, &quot;hamburger&quot;, &quot;jacket potato&quot;, &quot;pizza&quot;));</span>
  int customersServed;
  int maxCustomers;
  int customersGenerated;
  int timeAllowed;
  float lastCustomer;
  float waitTime;
  Boolean isPowerUp;
  PowerUpRunner powerups;
<span class="fc" id="L56">  ReputationPoints reputationPoints = new ReputationPoints(3);</span>
<span class="fc" id="L57">  float lastRepPointLost = 0;</span>
  int difficulty;
  GameSaver save;
  float totalTimerDisplay;

  /**
   * ScenarioGameMaster constructor.
   *
   * @param game PiazzaPanicGame instance.
   * @param map TiledMap instance.
   * @param chefno Number of chefs.
   * @param custno Number of customers.
   * @param machineUnlockBalance A class that controls the in game currency.
   * @param ingredientsHelper Staff member which can get ingredients.
   * @param deliveryStaff Staff member who serves customers.
   * @param disablePowerup Turn power ups off.
   * @param difficulty Game difficulty setting.
   */
  public ScenarioGameMaster(
      PiazzaPanicGame game,
      TiledMap map,
      int chefno,
      int custno,
      Money machineUnlockBalance,
      IngredientsStaff ingredientsHelper,
      DeliveryStaff deliveryStaff,
      Boolean disablePowerup,
<span class="fc" id="L84">      int difficulty) {</span>
<span class="fc" id="L85">    this.machineUnlockBalance = machineUnlockBalance;</span>
<span class="fc" id="L86">    this.staffOne = ingredientsHelper;</span>
<span class="fc" id="L87">    this.deliveryStaff = deliveryStaff;</span>
<span class="fc" id="L88">    this.game = game;</span>
<span class="fc" id="L89">    settings = Utility.getSettings();</span>
<span class="fc" id="L90">    this.map = new TiledMapMaster(map);</span>
<span class="fc" id="L91">    collisionLayer = (TiledMapTileLayer) map.getLayers().get(3);</span>
<span class="fc bfc" id="L92" title="All 2 branches covered.">    this.isPowerUp = !disablePowerup;</span>
<span class="fc" id="L93">    this.difficulty = difficulty;</span>

<span class="fc" id="L95">    this.save = new GameSaver(&quot;here.json&quot;);</span>

<span class="fc" id="L97">    this.save.setDifficulty(difficulty);</span>
<span class="fc" id="L98">    this.save.setPowerUp(disablePowerup);</span>
<span class="fc" id="L99">    this.save.setCustomersRemaining(custno);</span>

<span class="fc bfc" id="L101" title="All 2 branches covered.">    for (int i = 0; i &lt; chefno; i++) {</span>
<span class="fc" id="L102">      chefs.add(new Chef(&quot;Chef&quot;, 6 + i, 5, 1, 1, 1, false, new Stack&lt;String&gt;(), i + 1));</span>
    }
<span class="fc" id="L104">    this.maxCustomers = custno;</span>

<span class="fc" id="L106">    totalTimer = 0f;</span>
<span class="fc" id="L107">    totalTimerDisplay = 0f;</span>

    // Assessment 1 (index 0-16)
<span class="fc" id="L110">    machines.put(&quot;fridge-meat&quot;, new Machine(&quot;fridge-meat&quot;, &quot;&quot;, &quot;meat&quot;, 0, false));</span>
<span class="fc" id="L111">    machines.put(&quot;fridge-tomato&quot;, new Machine(&quot;fridge-tomato&quot;, &quot;&quot;, &quot;tomato&quot;, 0, false));</span>
<span class="fc" id="L112">    machines.put(&quot;fridge-lettuce&quot;, new Machine(&quot;fridge-lettuce&quot;, &quot;&quot;, &quot;lettuce&quot;, 0, false));</span>
<span class="fc" id="L113">    machines.put(&quot;fridge-onion&quot;, new Machine(&quot;fridge-onion&quot;, &quot;&quot;, &quot;onion&quot;, 0, false));</span>
<span class="fc" id="L114">    machines.put(&quot;fridge-bun&quot;, new Machine(&quot;fridge-bun&quot;, &quot;&quot;, &quot;bun&quot;, 0, false));</span>

<span class="fc" id="L116">    machineUnlockBalance.addGroup(&quot;grill&quot;, 100f);</span>
<span class="fc" id="L117">    machines.put(&quot;grill-patty-1&quot;, new Machine(&quot;grill-patty-1&quot;, &quot;patty&quot;, &quot;burger&quot;, 3, true));</span>
<span class="fc" id="L118">    machines.put(</span>
<span class="fc" id="L119">        &quot;grill-patty-2&quot;, new Machine(&quot;grill-patty-2&quot;, &quot;patty&quot;, &quot;burger&quot;, 3, true, &quot;grill&quot;));</span>
<span class="fc" id="L120">    machines.put(&quot;grill-bun-1&quot;, new Machine(&quot;grill-bun-1&quot;, &quot;bun&quot;, &quot;toasted bun&quot;, 3, true));</span>
<span class="fc" id="L121">    machines.put(&quot;grill-bun-2&quot;, new Machine(&quot;grill-bun-2&quot;, &quot;bun&quot;, &quot;toasted bun&quot;, 3, true, &quot;grill&quot;));</span>

<span class="fc" id="L123">    machineUnlockBalance.addGroup(&quot;forming&quot;, 50f);</span>
<span class="fc" id="L124">    machines.put(&quot;forming-1&quot;, new Machine(&quot;forming-1&quot;, &quot;meat&quot;, &quot;patty&quot;, 3, true));</span>
<span class="fc" id="L125">    machines.put(&quot;forming-2&quot;, new Machine(&quot;forming-2&quot;, &quot;meat&quot;, &quot;patty&quot;, 3, true, &quot;forming&quot;));</span>

<span class="fc" id="L127">    machineUnlockBalance.addGroup(&quot;chopping&quot;, 50f);</span>
<span class="fc" id="L128">    machines.put(</span>
<span class="fc" id="L129">        &quot;chopping-tomato-1&quot;, new Machine(&quot;chopping-tomato-1&quot;, &quot;tomato&quot;, &quot;chopped tomato&quot;, 3, true));</span>
<span class="fc" id="L130">    machines.put(</span>
        &quot;chopping-tomato-2&quot;,
<span class="fc" id="L132">        new Machine(&quot;chopping-tomato-2&quot;, &quot;tomato&quot;, &quot;chopped tomato&quot;, 3, true, &quot;chopping&quot;));</span>
<span class="fc" id="L133">    machines.put(</span>
        &quot;chopping-lettuce-1&quot;,
<span class="fc" id="L135">        new Machine(&quot;chopping-lettuce-1&quot;, &quot;lettuce&quot;, &quot;chopped lettuce&quot;, 3, true));</span>
<span class="fc" id="L136">    machines.put(</span>
        &quot;chopping-lettuce-2&quot;,
<span class="fc" id="L138">        new Machine(&quot;chopping-lettuce-2&quot;, &quot;lettuce&quot;, &quot;chopped lettuce&quot;, 3, true, &quot;chopping&quot;));</span>
<span class="fc" id="L139">    machines.put(</span>
<span class="fc" id="L140">        &quot;chopping-onion-1&quot;, new Machine(&quot;chopping-onion-1&quot;, &quot;onion&quot;, &quot;chopped onion&quot;, 3, true));</span>
<span class="fc" id="L141">    machines.put(</span>
        &quot;chopping-onion-2&quot;,
<span class="fc" id="L143">        new Machine(&quot;chopping-onion-2&quot;, &quot;onion&quot;, &quot;chopped onion&quot;, 3, true, &quot;chopping&quot;));</span>

    // Assessment 2 (index 17-24)
<span class="fc" id="L146">    machines.put(&quot;fridge-dough&quot;, new Machine(&quot;fridge-dough&quot;, &quot;&quot;, &quot;dough&quot;, 0, false));</span>
<span class="fc" id="L147">    machines.put(&quot;fridge-cheese&quot;, new Machine(&quot;fridge-cheese&quot;, &quot;&quot;, &quot;cheese&quot;, 0, false));</span>
<span class="fc" id="L148">    machines.put(&quot;fridge-potato&quot;, new Machine(&quot;fridge-potato&quot;, &quot;&quot;, &quot;potato&quot;, 0, false));</span>
<span class="fc" id="L149">    machines.put(&quot;fridge-beans&quot;, new Machine(&quot;fridge-beans&quot;, &quot;&quot;, &quot;beans&quot;, 0, false));</span>

<span class="fc" id="L151">    machineUnlockBalance.addGroup(&quot;potato&quot;, 150f);</span>
<span class="fc" id="L152">    machines.put(&quot;oven-potato-1&quot;, new Machine(&quot;oven-potato-1&quot;, &quot;potato&quot;, &quot;jacket&quot;, 3, true));</span>
<span class="fc" id="L153">    machines.put(</span>
<span class="fc" id="L154">        &quot;oven-potato-2&quot;, new Machine(&quot;oven-potato-2&quot;, &quot;potato&quot;, &quot;jacket&quot;, 3, true, &quot;potato&quot;));</span>

<span class="fc" id="L156">    machineUnlockBalance.addGroup(&quot;pizza&quot;, 150f);</span>
<span class="fc" id="L157">    machines.put(&quot;oven-pizza-1&quot;, new Machine(&quot;oven-pizza-1&quot;, &quot;raw pizza&quot;, &quot;pizza&quot;, 3, true));</span>
<span class="fc" id="L158">    machines.put(</span>
<span class="fc" id="L159">        &quot;oven-pizza-2&quot;, new Machine(&quot;oven-pizza-2&quot;, &quot;raw pizza&quot;, &quot;pizza&quot;, 3, true, &quot;pizza&quot;));</span>

    // disposal and tray/serving handled separately

<span class="fc" id="L163">    grill = Gdx.audio.newSound(Gdx.files.internal(&quot;sounds/grill.mp3&quot;));</span>
<span class="fc" id="L164">    chopping = Gdx.audio.newSound(Gdx.files.internal(&quot;sounds/chopping.mp3&quot;));</span>
<span class="fc" id="L165">    serving = Gdx.audio.newSound(Gdx.files.internal(&quot;sounds/serving.mp3&quot;));</span>
<span class="fc" id="L166">    fridge = Gdx.audio.newSound(Gdx.files.internal(&quot;sounds/fridge.mp3&quot;));</span>
<span class="fc" id="L167">    forming = Gdx.audio.newSound(Gdx.files.internal(&quot;sounds/forming.mp3&quot;));</span>
<span class="fc" id="L168">    trash = Gdx.audio.newSound(Gdx.files.internal(&quot;sounds/trash.mp3&quot;));</span>

<span class="pc bpc" id="L170" title="3 of 4 branches missed.">    switch (settings.get(1).trim()) {</span>
      case &quot;full&quot;:
<span class="nc" id="L172">        soundVolume = 1f;</span>
<span class="nc" id="L173">        break;</span>
      case &quot;half&quot;:
<span class="nc" id="L175">        soundVolume = 0.5f;</span>
<span class="nc" id="L176">        break;</span>
      case &quot;none&quot;:
<span class="fc" id="L178">        soundVolume = 0f;</span>
<span class="fc" id="L179">        break;</span>
      default:
        break;
    }

<span class="fc" id="L184">    machineUnlockBalance.addGroup(&quot;ingredients-staff&quot;, 150f);</span>
<span class="fc" id="L185">    machineUnlockBalance.addGroup(&quot;server-staff&quot;, 50f);</span>

<span class="fc" id="L187">    this.powerups = new PowerUpRunner(chefs, machines, machineUnlockBalance, save);</span>

<span class="fc" id="L189">    this.machineUnlockBalance.saveMoneyDetails(this.save);</span>
<span class="fc" id="L190">  }</span>

  /**
   * Setter method for selectedChef. Indexing is changed to represent java indexing starting from 0
   * but numbering for chefs starting from 1.
   *
   * @param selectedChef Index of the chef that movement needs to be applied on.
   */
  public void setSelectedChef(int selectedChef) {
<span class="fc" id="L199">    this.selectedChef = selectedChef - 1;</span>
<span class="fc" id="L200">  }</span>

  /**
   * Getter method for selectedChef. Indexing is changed to represent java indexing starting from 0
   * but numbering for chefs starting from 1.
   *
   * @return Index of the chef that movement will be applied on.
   */
  public int getSelectedChef() {
<span class="fc" id="L209">    return selectedChef + 1;</span>
  }

  /**
   * Access method for any chef in the chefs array. Indexing is changed to represent java indexing
   * starting from 0 but numbering for chefs starting from 1.
   *
   * @param i ith position in the chefs array that needs to be accessed.
   * @return chef object based upon ith position passed in.
   */
  public Chef getChef(int i) {
<span class="fc" id="L220">    return chefs.get(i - 1);</span>
  }

  /**
   * Used to set the current recipe to the ingredients staff member if this staff member has been
   * unlocked.
   */
  public void setRecipeToStaff() {
<span class="nc bnc" id="L228" title="All 2 branches missed.">    if (machineUnlockBalance.isUnlocked(&quot;ingredients-staff&quot;)) {</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">      if (!customers.isEmpty()) {</span>
<span class="nc" id="L230">        staffOne.setCurrentRecipe(customers.peek().getOrder());</span>
      }
    }
<span class="nc" id="L233">  }</span>

  /**
   * Attempts to move the currently selected chef in a specified direction. If the move is valid,
   * the facing variable for the currently selected chef will be set.
   *
   * @param direction Direction to move.
   */
  public void tryMove(String direction) {
<span class="fc" id="L242">    Chef chef = chefs.get(selectedChef);</span>
<span class="pc bpc" id="L243" title="1 of 2 branches missed.">    if (totalTimer &lt; (chef.getLastMove() + 1F / 5F)) {</span>
<span class="fc" id="L244">      return;</span>
    }
<span class="nc" id="L246">    chef.setLastMove(totalTimer);</span>
<span class="nc bnc" id="L247" title="All 5 branches missed.">    switch (direction) {</span>
      case &quot;up&quot;:
<span class="nc bnc" id="L249" title="All 2 branches missed.">        if (wouldNotCollide(chef.getxCoord(), chef.getyCoord() + 1, selectedChef)) {</span>
<span class="nc" id="L250">          chef.alteryCoord(+1);</span>
        }
<span class="nc" id="L252">        chef.setFacing(&quot;up&quot;);</span>
<span class="nc" id="L253">        break;</span>
      case &quot;down&quot;:
<span class="nc bnc" id="L255" title="All 2 branches missed.">        if (wouldNotCollide(chef.getxCoord(), chef.getyCoord() - 1, selectedChef)) {</span>
<span class="nc" id="L256">          chef.alteryCoord(-1);</span>
        }
<span class="nc" id="L258">        chef.setFacing(&quot;down&quot;);</span>
<span class="nc" id="L259">        break;</span>
      case &quot;left&quot;:
<span class="nc bnc" id="L261" title="All 2 branches missed.">        if (wouldNotCollide(chef.getxCoord() - 1, chef.getyCoord(), selectedChef)) {</span>
<span class="nc" id="L262">          chef.alterxCoord(-1);</span>
        }
<span class="nc" id="L264">        chef.setFacing(&quot;left&quot;);</span>
<span class="nc" id="L265">        break;</span>
      case &quot;right&quot;:
<span class="nc bnc" id="L267" title="All 2 branches missed.">        if (wouldNotCollide(chef.getxCoord() + 1, chef.getyCoord(), selectedChef)) {</span>
<span class="nc" id="L268">          chef.alterxCoord(+1);</span>
        }
<span class="nc" id="L270">        chef.setFacing(&quot;right&quot;);</span>
<span class="nc" id="L271">        break;</span>
      default:
        break;
    }
<span class="nc" id="L275">  }</span>

  /**
   * Checks collision with the collision layer, other chefs, and being stickied.
   *
   * @param x x coordinate to check.
   * @param y y coordinate to check.
   * @param chefno chef number to check.
   * @return true if the chef would not collide, false otherwise.
   */
  public boolean wouldNotCollide(int x, int y, int chefno) {
<span class="fc bfc" id="L286" title="All 2 branches covered.">    if (chefs.get(chefno).getIsStickied()) {</span>
<span class="fc" id="L287">      return false;</span>
    }
<span class="pc bpc" id="L289" title="1 of 2 branches missed.">    for (int i = 0; i &lt; chefs.size(); i++) {</span>
<span class="pc bpc" id="L290" title="2 of 6 branches missed.">      if (i != chefno &amp;&amp; chefs.get(i).getxCoord() == x &amp;&amp; chefs.get(i).getyCoord() == y) {</span>
<span class="fc" id="L291">        return false;</span>
      }
    }
<span class="nc" id="L294">    int tempCellTileID = collisionLayer.getCell(x, y).getTile().getId();</span>
<span class="nc bnc" id="L295" title="All 4 branches missed.">    return tempCellTileID != 37 &amp;&amp; tempCellTileID != 39;</span>
  }

  /**
   * Calculates size of customers array.
   *
   * @return The amount of customers which are yet to be served.
   */
  public int getCustomersRemaining() {
<span class="nc" id="L304">    return customers.size();</span>
  }

  /**
   * Calculates the first customer at the start of the customers array.
   *
   * @return The customer which is at the start of the queue.
   */
  public Customer getFirstCustomer() {
<span class="fc bfc" id="L313" title="All 2 branches covered.">    if (customers.size() &gt; 0) {</span>
<span class="fc" id="L314">      return customers.peek();</span>
    } else {
<span class="fc" id="L316">      return null;</span>
    }
  }

  /**
   * Updates all in game timers, performs any checks or functions required every frame. To be called
   * every frame render.
   *
   * @param delta time since last frame.
   */
  public void tickUpdate(float delta) {
    // TODO: play test and adjust difficulty scaling according to feedback

<span class="fc" id="L329">    lastRepPointLost =</span>
<span class="fc" id="L330">        checkOrderExpired(</span>
            customers,
            totalTimerDisplay,
            difficulty,
<span class="fc" id="L334">            reputationPoints.getPoints(),</span>
            customersServed,
            lastRepPointLost);
<span class="pc bpc" id="L337" title="3 of 6 branches missed.">    if (maxCustomers == -1 || (maxCustomers &gt; 0 &amp;&amp; customersGenerated &lt; maxCustomers)) {</span>
<span class="fc" id="L338">      createCustomers(</span>
          customers,
          lastCustomer,
          customersServed,
          customersGenerated,
          maxCustomers,
          difficulty,
          totalTimer);
    }

<span class="pc bpc" id="L348" title="3 of 4 branches missed.">    if ((customersGenerated == maxCustomers &amp;&amp; customers.size() == 0)</span>
<span class="pc bpc" id="L349" title="1 of 2 branches missed.">        || reputationPoints.getPoints() &lt;= 0) {</span>
<span class="nc bnc" id="L350" title="All 2 branches missed.">      game.setScreen(</span>
          new GameWinScreen(
<span class="nc" id="L352">              game, (int) totalTimerDisplay, false, (maxCustomers == -1), isPowerUp, difficulty));</span>
    }

<span class="fc" id="L355">    float increment = powerups.updateValues(delta);</span>

<span class="fc bfc" id="L357" title="All 2 branches covered.">    for (String machine : machines.keySet()) {</span>
<span class="fc" id="L358">      Machine tempMachine = machines.get(machine);</span>
<span class="pc bpc" id="L359" title="1 of 2 branches missed.">      if (tempMachine.getActive()) {</span>
<span class="nc" id="L360">        tempMachine.incrementRuntime(delta);</span>
<span class="nc" id="L361">        tempMachine.attemptGetOutput();</span>
      }
<span class="fc" id="L363">    }</span>

    // Delta is needed to move chefs.
<span class="fc" id="L366">    totalTimerDisplay += increment;</span>
<span class="fc" id="L367">    totalTimer += delta;</span>

<span class="fc" id="L369">    this.save.setChefDetails(chefs, selectedChef);</span>
<span class="fc" id="L370">    this.save.setReputationPoints(reputationPoints.getPoints());</span>
<span class="fc" id="L371">    this.save.setTime(totalTimerDisplay);</span>
<span class="fc" id="L372">    this.save.setRecipe(getFirstCustomer());</span>
<span class="fc" id="L373">    this.save.setTrays(tray1.getList(), tray2.getList());</span>
<span class="fc" id="L374">  }</span>

  /**
   * Attempts to cause an interaction between the currently selected chef and the machine in front
   * of them.
   */
  public void tryInteract() {
<span class="fc" id="L381">    Chef chef = chefs.get(selectedChef);</span>

    int targetx;
    int targety;
<span class="pc bpc" id="L385" title="1 of 5 branches missed.">    switch (chef.getFacing()) {</span>
      case &quot;up&quot;:
<span class="fc" id="L387">        targetx = chef.getxCoord();</span>
<span class="fc" id="L388">        targety = chef.getyCoord() + 1;</span>
<span class="fc" id="L389">        break;</span>
      case &quot;down&quot;:
<span class="fc" id="L391">        targetx = chef.getxCoord();</span>
<span class="fc" id="L392">        targety = chef.getyCoord() - 1;</span>
<span class="fc" id="L393">        break;</span>
      case &quot;left&quot;:
<span class="fc" id="L395">        targetx = chef.getxCoord() - 1;</span>
<span class="fc" id="L396">        targety = chef.getyCoord();</span>
<span class="fc" id="L397">        break;</span>
      case &quot;right&quot;:
<span class="fc" id="L399">        targetx = chef.getxCoord() + 1;</span>
<span class="fc" id="L400">        targety = chef.getyCoord();</span>
<span class="fc" id="L401">        break;</span>
      default:
<span class="nc" id="L403">        targetx = chef.getxCoord();</span>
<span class="nc" id="L404">        targety = chef.getyCoord();</span>
        break;
    }

    // Unlock layer - interactions with any stations that need to be
    // purchased using credits.
<span class="fc" id="L410">    MapObjects unlockObjects = map.getObjectLayers(&quot;Unlock Layer&quot;);</span>

<span class="fc bfc" id="L412" title="All 2 branches covered.">    for (MapObject ob : unlockObjects) {</span>
<span class="pc bpc" id="L413" title="1 of 2 branches missed.">      if (map.detectInteractionFromTiledObject(map.loadRectangle(ob), targetx, targety)) {</span>
<span class="nc" id="L414">        machineUnlockBalance.unlockMachine(ob.getName());</span>
      }
<span class="fc" id="L416">    }</span>

    // Fridge layer - contains all fridges in order to pick up ingredients.
<span class="fc" id="L419">    MapObjects fridgeObjects = map.getObjectLayers(&quot;Fridge Layer&quot;);</span>
<span class="fc bfc" id="L420" title="All 2 branches covered.">    for (MapObject ob : fridgeObjects) {</span>
<span class="fc bfc" id="L421" title="All 2 branches covered.">      if (map.detectInteractionFromTiledObject(map.loadRectangle(ob), targetx, targety)) {</span>
<span class="fc" id="L422">        machines.get(ob.getName()).process(chef, machineUnlockBalance);</span>
<span class="fc" id="L423">        fridge.play(soundVolume);</span>
      }
<span class="fc" id="L425">    }</span>

    // Cooking Objects - contain all machines
<span class="fc" id="L428">    MapObjects cookingObjects = map.getObjectLayers(&quot;Cooking Layer&quot;);</span>

<span class="fc" id="L430">    String invTop = &quot;&quot;;</span>
<span class="fc bfc" id="L431" title="All 2 branches covered.">    if (chef.getInventory().size() != 0) {</span>
      // Work stations
<span class="fc" id="L433">      invTop = chef.getInventory().peek();</span>
    }

<span class="fc bfc" id="L436" title="All 2 branches covered.">    for (MapObject ob : cookingObjects) {</span>
      // Only use a machine if you are trying to interact with it and have the correct
      // input.
<span class="fc bfc" id="L439" title="All 2 branches covered.">      if (map.detectInteractionFromTiledObject(map.loadRectangle(ob), targetx, targety)</span>
<span class="pc bpc" id="L440" title="1 of 2 branches missed.">          &amp;&amp; machines.get(ob.getName()) == chef.getMachineInteractingWith()) {</span>
<span class="nc" id="L441">        machines.get(ob.getName()).attemptCompleteAction();</span>
<span class="fc bfc" id="L442" title="All 2 branches covered.">      } else if (map.detectInteractionFromTiledObject(map.loadRectangle(ob), targetx, targety)</span>
<span class="pc bpc" id="L443" title="1 of 2 branches missed.">          &amp;&amp; chef.getMachineInteractingWith() == null</span>
<span class="fc bfc" id="L444" title="All 2 branches covered.">          &amp;&amp; machines.get(ob.getName()).getInput().equals(invTop)) {</span>
<span class="fc" id="L445">        machines.get(ob.getName()).process(chef, machineUnlockBalance);</span>
      }
<span class="fc" id="L447">    }</span>

<span class="fc" id="L449">    MapObjects miscObjects = map.getObjectLayers(&quot;Misc Layer&quot;);</span>

<span class="fc bfc" id="L451" title="All 2 branches covered.">    if (map.detectInteractionFromTiledObject(</span>
<span class="fc" id="L452">        map.loadRectangle(miscObjects.get(&quot;bin&quot;)), targetx, targety)) {</span>
<span class="pc bpc" id="L453" title="1 of 2 branches missed.">      if (!chef.getInventory().isEmpty()) {</span>
<span class="fc" id="L454">        chef.removeTopFromInventory();</span>
<span class="fc" id="L455">        trash.play(soundVolume);</span>
      }
<span class="pc bpc" id="L457" title="1 of 2 branches missed.">    } else if (map.detectInteractionFromTiledObject(</span>
<span class="fc" id="L458">        map.loadRectangle(miscObjects.get(&quot;serving&quot;)), targetx, targety)) {</span>
<span class="nc" id="L459">      serveFood();</span>
<span class="pc bpc" id="L460" title="1 of 2 branches missed.">    } else if (map.detectInteractionFromTiledObject(</span>
<span class="fc" id="L461">        map.loadRectangle(miscObjects.get(&quot;tray-1&quot;)), targetx, targety)) {</span>
<span class="nc" id="L462">      tray1.addToTray(chefs.get(selectedChef), deliveryStaff, customers, machineUnlockBalance);</span>
<span class="pc bpc" id="L463" title="1 of 2 branches missed.">    } else if (map.detectInteractionFromTiledObject(</span>
<span class="fc" id="L464">        map.loadRectangle(miscObjects.get(&quot;tray-2&quot;)), targetx, targety)) {</span>
<span class="nc" id="L465">      tray2.addToTray(chefs.get(selectedChef), deliveryStaff, customers, machineUnlockBalance);</span>
<span class="pc bpc" id="L466" title="1 of 2 branches missed.">    } else if (map.detectInteractionFromTiledObject(</span>
<span class="fc" id="L467">        map.loadRectangle(miscObjects.get(&quot;fast-track-collect&quot;)), targetx, targety)) {</span>
<span class="nc" id="L468">      String item = staffOne.collectItem();</span>
      // Don't add a null pointer onto the chefs stack.
<span class="nc bnc" id="L470" title="All 2 branches missed.">      if (item != null) {</span>
<span class="nc" id="L471">        Machine tempMachine = new Machine(&quot;staff&quot;, item, item, 0, true, &quot;ingredients-staff&quot;);</span>
<span class="nc" id="L472">        tempMachine.processStaffInteraction(chef, machineUnlockBalance);</span>
      }
    }
<span class="fc" id="L475">  }</span>

  /**
   * Getter method for the money class.
   *
   * @return Instance of the money class that is being used within scenario game master.
   */
  public Money getUnlockClass() {
<span class="fc" id="L483">    return machineUnlockBalance;</span>
  }

  /** Method to handle giving food to the customer. */
  public void serveFood() {
<span class="nc bnc" id="L488" title="All 2 branches missed.">    if (customers.isEmpty()) {</span>
<span class="nc" id="L489">      return;</span>
    }
<span class="nc" id="L491">    Chef chef = chefs.get(selectedChef);</span>
    Stack&lt;String&gt; inv;
    // If the order isn't pizza and the server is unlocked,
    // get the order from the staff members inventory.
    // Otherwise, get the chefs inventory and operate
    // from there.
<span class="nc bnc" id="L497" title="All 2 branches missed.">    if (machineUnlockBalance.isUnlocked(&quot;server-staff&quot;)</span>
<span class="nc bnc" id="L498" title="All 2 branches missed.">        &amp;&amp; !(customers.peek().getOrder().equals(&quot;pizza&quot;))) {</span>
<span class="nc" id="L499">      inv = deliveryStaff.getItems();</span>
    } else {
<span class="nc" id="L501">      inv = chef.getInventory();</span>
    }

<span class="nc bnc" id="L504" title="All 2 branches missed.">    if (inv.size() == 0) {</span>
<span class="nc" id="L505">      return;</span>
    }

<span class="nc bnc" id="L508" title="All 2 branches missed.">    if (customers.peek().getOrder().equals(inv.peek())) {</span>
<span class="nc" id="L509">      inv.pop();</span>
<span class="nc" id="L510">      customers.poll();</span>
<span class="nc" id="L511">      customersServed += 1;</span>
<span class="nc" id="L512">      this.save.decrementCustomers();</span>
<span class="nc" id="L513">      serving.play(soundVolume);</span>

<span class="nc bnc" id="L515" title="All 2 branches missed.">      if (customersServed == maxCustomers) {</span>
<span class="nc bnc" id="L516" title="All 2 branches missed.">        game.setScreen(</span>
            new GameWinScreen(
<span class="nc" id="L518">                game, (int) totalTimerDisplay, true, (maxCustomers == -1), isPowerUp, 0));</span>
      }

      // +$100 on completion of a recipe.
<span class="nc" id="L522">      machineUnlockBalance.incrementBalance();</span>
      // Once an order is complete, allow ingredient staff to
      // collect another order.
<span class="nc" id="L525">      staffOne.setGenerate(true);</span>
<span class="nc" id="L526">      this.machineUnlockBalance.saveMoneyDetails(this.save);</span>

      // Activate random power up if a recipe is complete.
<span class="nc bnc" id="L529" title="All 2 branches missed.">      if (isPowerUp) {</span>
<span class="nc" id="L530">        this.powerups.activateRandomPowerUp();</span>
      }
    }
<span class="nc" id="L533">  }</span>

  /**
   * Getter method for the game's PowerUpRunner instance.
   *
   * @return Instance of PowerUpRunner used in the game.
   */
  public PowerUpRunner getPowerUpRunner() {
<span class="fc" id="L541">    return powerups;</span>
  }

  /**
   * Getter method for the game's GameSaver instance.
   *
   * @return Instance of GameSaver used in the game.
   */
  public GameSaver getSave() {
<span class="nc" id="L550">    return save;</span>
  }

  /**
   * Setter method for reputation points.
   *
   * @param reputationPoints Number of reputation points.
   */
  public void setReputationPoints(int overwriteValue) {
<span class="fc" id="L559">    reputationPoints.overwritePoints(overwriteValue);</span>
<span class="fc" id="L560">  }</span>

  /**
   * Setter method for game runtime.
   *
   * @param timeElapsed Amount of time the game has been running.
   */
  public void setTimeElapsed(float timeElapsed) {
<span class="fc" id="L568">    this.totalTimer = timeElapsed;</span>
<span class="fc" id="L569">    this.totalTimerDisplay = timeElapsed;</span>
<span class="fc" id="L570">  }</span>

  /**
   * Getter method for game runtime.
   *
   * @return Amount of time the game has been running.
   */
  public float getTimer() {
<span class="fc" id="L578">    return totalTimerDisplay;</span>
  }

  /**
   * Adds given item to a specified tray. Bypasses order completion checks, only use with
   * GameReader.
   *
   * @param number Number of the tray being added to.
   * @param item Name of item being added to the tray.
   */
  public void addtoTray(int number, String item) {
<span class="pc bpc" id="L589" title="1 of 2 branches missed.">    if (number == 1) {</span>
<span class="fc" id="L590">      tray1.putOnTray(item);</span>
<span class="nc bnc" id="L591" title="All 2 branches missed.">    } else if (number == 2) {</span>
<span class="nc" id="L592">      tray2.putOnTray(item);</span>
    }
<span class="fc" id="L594">  }</span>

  public ArrayList&lt;Chef&gt; getChefs() {
<span class="fc" id="L597">    return chefs;</span>
  }

  public float getTotalTimerDisplay() {
<span class="fc" id="L601">    return totalTimerDisplay;</span>
  }

  public float getTotalTimer() {
<span class="nc" id="L605">    return totalTimer;</span>
  }

  public float getLastRepPointLost() {
<span class="nc" id="L609">    return lastRepPointLost;</span>
  }

  public int getReputationPoints() {
<span class="nc" id="L613">    return reputationPoints.getPoints();</span>
  }

  public Queue&lt;Customer&gt; getCustomers() {
<span class="nc" id="L617">    return customers;</span>
  }

  public ArrayList&lt;String&gt; getTray1() {
<span class="nc" id="L621">    return tray1.getList();</span>
  }

  public ArrayList&lt;String&gt; getTray2() {
<span class="nc" id="L625">    return tray2.getList();</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>