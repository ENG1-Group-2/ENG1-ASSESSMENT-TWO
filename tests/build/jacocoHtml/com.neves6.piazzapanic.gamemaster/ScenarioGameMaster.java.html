<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ScenarioGameMaster.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">tests</a> &gt; <a href="index.source.html" class="el_package">com.neves6.piazzapanic.gamemaster</a> &gt; <span class="el_source">ScenarioGameMaster.java</span></div><h1>ScenarioGameMaster.java</h1><pre class="source lang-java linenums">package com.neves6.piazzapanic.gamemaster;

import static com.neves6.piazzapanic.gamemechanisms.OrderMaster.checkOrderExpired;
import static com.neves6.piazzapanic.gamemechanisms.OrderMaster.createCustomers;
import static java.util.Arrays.asList;

import com.badlogic.gdx.Gdx;
import com.badlogic.gdx.audio.Sound;
import com.badlogic.gdx.maps.MapObject;
import com.badlogic.gdx.maps.MapObjects;
import com.badlogic.gdx.maps.tiled.TiledMap;
import com.badlogic.gdx.maps.tiled.TiledMapTileLayer;
import com.neves6.piazzapanic.gamemechanisms.*;
import com.neves6.piazzapanic.people.Chef;
import com.neves6.piazzapanic.people.Customer;
import com.neves6.piazzapanic.powerups.PowerUpRunner;
import com.neves6.piazzapanic.screens.GameWinScreen;
import com.neves6.piazzapanic.screens.PiazzaPanicGame;
import com.neves6.piazzapanic.staff.DeliveryStaff;
import com.neves6.piazzapanic.staff.IngredientsStaff;
import java.util.*;
import java.util.concurrent.ThreadLocalRandom;

/** A class designed to handle all in game processing. */
public class ScenarioGameMaster {
  DeliveryStaff deliveryStaff;
  IngredientsStaff staffOne;
  PiazzaPanicGame game;
  TiledMapMaster map;
  TiledMapTileLayer collisionLayer;
<span class="fc" id="L31">  ArrayList&lt;Chef&gt; chefs = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L32">  Queue&lt;Customer&gt; customers = new LinkedList&lt;&gt;();</span>
<span class="fc" id="L33">  Map&lt;String, Machine&gt; machines = new HashMap();</span>
<span class="fc" id="L34">  Tray tray1 = new Tray();</span>
<span class="fc" id="L35">  Tray tray2 = new Tray();</span>
  int selectedChef;
  float totalTimer;
  Sound grill;
  Sound chopping;
  Sound serving;
  Sound fridge;
  Sound forming;
  Sound trash;
  float soundVolume;
  ArrayList&lt;String&gt; settings;
  Money machineUnlockBalance;
<span class="fc" id="L47">  ArrayList&lt;String&gt; recipes =</span>
<span class="fc" id="L48">      new ArrayList&lt;&gt;(asList(&quot;salad&quot;, &quot;hamburger&quot;, &quot;jacket potato&quot;, &quot;pizza&quot;));</span>
  int customersServed;
  int maxCustomers;
  int customersGenerated;
  int timeAllowed;
  float lastCustomer;
  float waitTime;
  Boolean isPowerUp;
  PowerUpRunner powerups;
<span class="fc" id="L57">  ReputationPoints reputationPoints = new ReputationPoints(3);</span>
<span class="fc" id="L58">  float lastRepPointLost = 0;</span>
  int difficulty;
  GameSaver save;
  float totalTimerDisplay;

  /**
   * ScenarioGameMaster constructor.
   *
   * @param game PiazzaPanicGame instance.
   * @param map TiledMap instance.
   * @param chefno Number of chefs.
   * @param custno Number of customers.
   * @param machineUnlockBalance A class that controls the in game currency.
   * @param ingredientsHelper Staff member which can get ingredients.
   * @param deliveryStaff Staff member who serves customers.
   * @param disablePowerup Turn power ups off.
   * @param difficulty Game difficulty setting.
   */
  public ScenarioGameMaster(
      PiazzaPanicGame game,
      TiledMap map,
      int chefno,
      int custno,
      Money machineUnlockBalance,
      IngredientsStaff ingredientsHelper,
      DeliveryStaff deliveryStaff,
      Boolean disablePowerup,
<span class="fc" id="L85">      int difficulty) {</span>
<span class="fc" id="L86">    this.machineUnlockBalance = machineUnlockBalance;</span>
<span class="fc" id="L87">    this.staffOne = ingredientsHelper;</span>
<span class="fc" id="L88">    this.deliveryStaff = deliveryStaff;</span>
<span class="fc" id="L89">    this.game = game;</span>
<span class="fc" id="L90">    settings = Utility.getSettings();</span>
<span class="fc" id="L91">    this.map = new TiledMapMaster(map);</span>
<span class="fc" id="L92">    collisionLayer = (TiledMapTileLayer) map.getLayers().get(3);</span>
<span class="fc bfc" id="L93" title="All 2 branches covered.">    this.isPowerUp = !disablePowerup;</span>
<span class="fc" id="L94">    this.difficulty = difficulty;</span>

<span class="fc" id="L96">    this.save = new GameSaver(&quot;here.json&quot;);</span>

<span class="fc" id="L98">    this.save.setDifficulty(difficulty);</span>
<span class="fc" id="L99">    this.save.setPowerUp(disablePowerup);</span>
<span class="fc" id="L100">    this.save.setCustomersRemaining(custno);</span>

<span class="fc bfc" id="L102" title="All 2 branches covered.">    for (int i = 0; i &lt; chefno; i++) {</span>
<span class="fc" id="L103">      chefs.add(new Chef(&quot;Chef&quot;, 6 + i, 5, 1, 1, 1, false, new Stack&lt;String&gt;(), i + 1));</span>
    }
<span class="fc" id="L105">    this.maxCustomers = custno;</span>

<span class="fc" id="L107">    totalTimer = 0f;</span>
<span class="fc" id="L108">    totalTimerDisplay = 0f;</span>

    // Assessment 1 (index 0-16)
<span class="fc" id="L111">    machines.put(&quot;fridge-meat&quot;, new Machine(&quot;fridge-meat&quot;, &quot;&quot;, &quot;meat&quot;, 0, false));</span>
<span class="fc" id="L112">    machines.put(&quot;fridge-tomato&quot;, new Machine(&quot;fridge-tomato&quot;, &quot;&quot;, &quot;tomato&quot;, 0, false));</span>
<span class="fc" id="L113">    machines.put(&quot;fridge-lettuce&quot;, new Machine(&quot;fridge-lettuce&quot;, &quot;&quot;, &quot;lettuce&quot;, 0, false));</span>
<span class="fc" id="L114">    machines.put(&quot;fridge-onion&quot;, new Machine(&quot;fridge-onion&quot;, &quot;&quot;, &quot;onion&quot;, 0, false));</span>
<span class="fc" id="L115">    machines.put(&quot;fridge-bun&quot;, new Machine(&quot;fridge-bun&quot;, &quot;&quot;, &quot;bun&quot;, 0, false));</span>

<span class="fc" id="L117">    machineUnlockBalance.addGroup(&quot;grill&quot;, 100f);</span>
<span class="fc" id="L118">    machines.put(&quot;grill-patty-1&quot;, new Machine(&quot;grill-patty-1&quot;, &quot;patty&quot;, &quot;burger&quot;, 3, true));</span>
<span class="fc" id="L119">    machines.put(</span>
<span class="fc" id="L120">        &quot;grill-patty-2&quot;, new Machine(&quot;grill-patty-2&quot;, &quot;patty&quot;, &quot;burger&quot;, 3, true, &quot;grill&quot;));</span>
<span class="fc" id="L121">    machines.put(&quot;grill-bun-1&quot;, new Machine(&quot;grill-bun-1&quot;, &quot;bun&quot;, &quot;toasted bun&quot;, 3, true));</span>
<span class="fc" id="L122">    machines.put(&quot;grill-bun-2&quot;, new Machine(&quot;grill-bun-2&quot;, &quot;bun&quot;, &quot;toasted bun&quot;, 3, true, &quot;grill&quot;));</span>

<span class="fc" id="L124">    machineUnlockBalance.addGroup(&quot;forming&quot;, 50f);</span>
<span class="fc" id="L125">    machines.put(&quot;forming-1&quot;, new Machine(&quot;forming-1&quot;, &quot;meat&quot;, &quot;patty&quot;, 3, true));</span>
<span class="fc" id="L126">    machines.put(&quot;forming-2&quot;, new Machine(&quot;forming-2&quot;, &quot;meat&quot;, &quot;patty&quot;, 3, true, &quot;forming&quot;));</span>

<span class="fc" id="L128">    machineUnlockBalance.addGroup(&quot;chopping&quot;, 50f);</span>
<span class="fc" id="L129">    machines.put(</span>
<span class="fc" id="L130">        &quot;chopping-tomato-1&quot;, new Machine(&quot;chopping-tomato-1&quot;, &quot;tomato&quot;, &quot;chopped tomato&quot;, 3, true));</span>
<span class="fc" id="L131">    machines.put(</span>
        &quot;chopping-tomato-2&quot;,
<span class="fc" id="L133">        new Machine(&quot;chopping-tomato-2&quot;, &quot;tomato&quot;, &quot;chopped tomato&quot;, 3, true, &quot;chopping&quot;));</span>
<span class="fc" id="L134">    machines.put(</span>
        &quot;chopping-lettuce-1&quot;,
<span class="fc" id="L136">        new Machine(&quot;chopping-lettuce-1&quot;, &quot;lettuce&quot;, &quot;chopped lettuce&quot;, 3, true));</span>
<span class="fc" id="L137">    machines.put(</span>
        &quot;chopping-lettuce-2&quot;,
<span class="fc" id="L139">        new Machine(&quot;chopping-lettuce-2&quot;, &quot;lettuce&quot;, &quot;chopped lettuce&quot;, 3, true, &quot;chopping&quot;));</span>
<span class="fc" id="L140">    machines.put(</span>
<span class="fc" id="L141">        &quot;chopping-onion-1&quot;, new Machine(&quot;chopping-onion-1&quot;, &quot;onion&quot;, &quot;chopped onion&quot;, 3, true));</span>
<span class="fc" id="L142">    machines.put(</span>
        &quot;chopping-onion-2&quot;,
<span class="fc" id="L144">        new Machine(&quot;chopping-onion-2&quot;, &quot;onion&quot;, &quot;chopped onion&quot;, 3, true, &quot;chopping&quot;));</span>

    // Assessment 2 (index 17-24)
<span class="fc" id="L147">    machines.put(&quot;fridge-dough&quot;, new Machine(&quot;fridge-dough&quot;, &quot;&quot;, &quot;dough&quot;, 0, false));</span>
<span class="fc" id="L148">    machines.put(&quot;fridge-cheese&quot;, new Machine(&quot;fridge-cheese&quot;, &quot;&quot;, &quot;cheese&quot;, 0, false));</span>
<span class="fc" id="L149">    machines.put(&quot;fridge-potato&quot;, new Machine(&quot;fridge-potato&quot;, &quot;&quot;, &quot;potato&quot;, 0, false));</span>
<span class="fc" id="L150">    machines.put(&quot;fridge-beans&quot;, new Machine(&quot;fridge-beans&quot;, &quot;&quot;, &quot;beans&quot;, 0, false));</span>

<span class="fc" id="L152">    machineUnlockBalance.addGroup(&quot;potato&quot;, 150f);</span>
<span class="fc" id="L153">    machines.put(&quot;oven-potato-1&quot;, new Machine(&quot;oven-potato-1&quot;, &quot;potato&quot;, &quot;jacket&quot;, 3, true));</span>
<span class="fc" id="L154">    machines.put(</span>
<span class="fc" id="L155">        &quot;oven-potato-2&quot;, new Machine(&quot;oven-potato-2&quot;, &quot;potato&quot;, &quot;jacket&quot;, 3, true, &quot;potato&quot;));</span>

<span class="fc" id="L157">    machineUnlockBalance.addGroup(&quot;pizza&quot;, 150f);</span>
<span class="fc" id="L158">    machines.put(&quot;oven-pizza-1&quot;, new Machine(&quot;oven-pizza-1&quot;, &quot;raw pizza&quot;, &quot;pizza&quot;, 3, true));</span>
<span class="fc" id="L159">    machines.put(</span>
<span class="fc" id="L160">        &quot;oven-pizza-2&quot;, new Machine(&quot;oven-pizza-2&quot;, &quot;raw pizza&quot;, &quot;pizza&quot;, 3, true, &quot;pizza&quot;));</span>

    // disposal and tray/serving handled separately

<span class="fc" id="L164">    grill = Gdx.audio.newSound(Gdx.files.internal(&quot;sounds/grill.mp3&quot;));</span>
<span class="fc" id="L165">    chopping = Gdx.audio.newSound(Gdx.files.internal(&quot;sounds/chopping.mp3&quot;));</span>
<span class="fc" id="L166">    serving = Gdx.audio.newSound(Gdx.files.internal(&quot;sounds/serving.mp3&quot;));</span>
<span class="fc" id="L167">    fridge = Gdx.audio.newSound(Gdx.files.internal(&quot;sounds/fridge.mp3&quot;));</span>
<span class="fc" id="L168">    forming = Gdx.audio.newSound(Gdx.files.internal(&quot;sounds/forming.mp3&quot;));</span>
<span class="fc" id="L169">    trash = Gdx.audio.newSound(Gdx.files.internal(&quot;sounds/trash.mp3&quot;));</span>

<span class="pc bpc" id="L171" title="3 of 4 branches missed.">    switch (settings.get(1).trim()) {</span>
      case &quot;full&quot;:
<span class="nc" id="L173">        soundVolume = 1f;</span>
<span class="nc" id="L174">        break;</span>
      case &quot;half&quot;:
<span class="nc" id="L176">        soundVolume = 0.5f;</span>
<span class="nc" id="L177">        break;</span>
      case &quot;none&quot;:
<span class="fc" id="L179">        soundVolume = 0f;</span>
<span class="fc" id="L180">        break;</span>
      default:
        break;
    }

<span class="fc" id="L185">    machineUnlockBalance.addGroup(&quot;ingredients-staff&quot;, 150f);</span>
<span class="fc" id="L186">    machineUnlockBalance.addGroup(&quot;server-staff&quot;, 50f);</span>

<span class="fc" id="L188">    this.powerups = new PowerUpRunner(chefs, machines, machineUnlockBalance, save);</span>

<span class="fc" id="L190">    this.machineUnlockBalance.saveMoneyDetails(this.save);</span>
<span class="fc" id="L191">  }</span>

  /**
   * Setter method for selectedChef. Indexing is changed to represent java indexing starting from 0
   * but numbering for chefs starting from 1.
   *
   * @param selectedChef Index of the chef that movement needs to be applied on.
   */
  public void setSelectedChef(int selectedChef) {
<span class="fc" id="L200">    this.selectedChef = selectedChef - 1;</span>
<span class="fc" id="L201">  }</span>

  /**
   * Getter method for selectedChef. Indexing is changed to represent java indexing starting from 0
   * but numbering for chefs starting from 1.
   *
   * @return Index of the chef that movement will be applied on.
   */
  public int getSelectedChef() {
<span class="fc" id="L210">    return selectedChef + 1;</span>
  }

  /**
   * Access method for any chef in the chefs array. Indexing is changed to represent java indexing
   * starting from 0 but numbering for chefs starting from 1.
   *
   * @param i ith position in the chefs array that needs to be accessed.
   * @return chef object based upon ith position passed in.
   */
  public Chef getChef(int i) {
<span class="fc" id="L221">    return chefs.get(i - 1);</span>
  }

  /**
   * Used to set the current recipe to the ingredients staff member if this staff member has been
   * unlocked.
   */
  public void setRecipeToStaff() {
<span class="nc bnc" id="L229" title="All 2 branches missed.">    if (machineUnlockBalance.isUnlocked(&quot;ingredients-staff&quot;)) {</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">      if (!customers.isEmpty()) {</span>
<span class="nc" id="L231">        staffOne.setCurrentRecipe(customers.peek().getOrder());</span>
      }
    }
<span class="nc" id="L234">  }</span>

  /**
   * Attempts to move the currently selected chef in a specified direction. If the move is valid,
   * the facing variable for the currently selected chef will be set.
   *
   * @param direction Direction to move.
   */
  public void tryMove(String direction) {
<span class="fc" id="L243">    Chef chef = chefs.get(selectedChef);</span>
<span class="pc bpc" id="L244" title="3 of 4 branches missed.">    if (!game.getTestMode() &amp;&amp; totalTimer &lt; (chef.getLastMove() + 1F / 5F)) {</span>
<span class="nc" id="L245">      return;</span>
    }
<span class="fc" id="L247">    chef.setLastMove(totalTimer);</span>
<span class="pc bpc" id="L248" title="1 of 5 branches missed.">    switch (direction) {</span>
      case &quot;up&quot;:
<span class="fc bfc" id="L250" title="All 2 branches covered.">        if (wouldNotCollide(chef.getxCoord(), chef.getyCoord() + 1, selectedChef)) {</span>
<span class="fc" id="L251">          chef.alteryCoord(+1);</span>
        }
<span class="fc" id="L253">        chef.setFacing(&quot;up&quot;);</span>
<span class="fc" id="L254">        break;</span>
      case &quot;down&quot;:
<span class="fc bfc" id="L256" title="All 2 branches covered.">        if (wouldNotCollide(chef.getxCoord(), chef.getyCoord() - 1, selectedChef)) {</span>
<span class="fc" id="L257">          chef.alteryCoord(-1);</span>
        }
<span class="fc" id="L259">        chef.setFacing(&quot;down&quot;);</span>
<span class="fc" id="L260">        break;</span>
      case &quot;left&quot;:
<span class="fc bfc" id="L262" title="All 2 branches covered.">        if (wouldNotCollide(chef.getxCoord() - 1, chef.getyCoord(), selectedChef)) {</span>
<span class="fc" id="L263">          chef.alterxCoord(-1);</span>
        }
<span class="fc" id="L265">        chef.setFacing(&quot;left&quot;);</span>
<span class="fc" id="L266">        break;</span>
      case &quot;right&quot;:
<span class="pc bpc" id="L268" title="1 of 2 branches missed.">        if (wouldNotCollide(chef.getxCoord() + 1, chef.getyCoord(), selectedChef)) {</span>
<span class="fc" id="L269">          chef.alterxCoord(+1);</span>
        }
<span class="fc" id="L271">        chef.setFacing(&quot;right&quot;);</span>
<span class="fc" id="L272">        break;</span>
      default:
        break;
    }
<span class="fc" id="L276">  }</span>

  /**
   * Checks collision with the collision layer, other chefs, and being stickied.
   *
   * @param x x coordinate to check.
   * @param y y coordinate to check.
   * @param chefno chef number to check.
   * @return true if the chef would not collide, false otherwise.
   */
  public boolean wouldNotCollide(int x, int y, int chefno) {
<span class="fc bfc" id="L287" title="All 2 branches covered.">    if (chefs.get(chefno).getIsStickied()) {</span>
<span class="fc" id="L288">      return false;</span>
    }
<span class="fc bfc" id="L290" title="All 2 branches covered.">    for (int i = 0; i &lt; chefs.size(); i++) {</span>
<span class="pc bpc" id="L291" title="2 of 6 branches missed.">      if (i != chefno &amp;&amp; chefs.get(i).getxCoord() == x &amp;&amp; chefs.get(i).getyCoord() == y) {</span>
<span class="fc" id="L292">        return false;</span>
      }
    }
<span class="fc" id="L295">    int tempCellTileID = collisionLayer.getCell(x, y).getTile().getId();</span>
<span class="fc bfc" id="L296" title="All 4 branches covered.">    return tempCellTileID != 37 &amp;&amp; tempCellTileID != 39;</span>
  }

  /**
   * Calculates size of customers array.
   *
   * @return The amount of customers which are yet to be served.
   */
  public int getCustomersRemaining() {
<span class="nc" id="L305">    return customers.size();</span>
  }

  /**
   * Calculates the first customer at the start of the customers array.
   *
   * @return The customer which is at the start of the queue.
   */
  public Customer getFirstCustomer() {
<span class="fc bfc" id="L314" title="All 2 branches covered.">    if (customers.size() &gt; 0) {</span>
<span class="fc" id="L315">      return customers.peek();</span>
    } else {
<span class="fc" id="L317">      return null;</span>
    }
  }

  /**
   * Updates all in game timers, performs any checks or functions required every frame. To be called
   * every frame render.
   *
   * @param delta time since last frame.
   */
  public void tickUpdate(float delta) {
    // TODO: play test and adjust difficulty scaling according to feedback

<span class="fc" id="L330">    lastRepPointLost = checkOrderExpired(customers, totalTimerDisplay, difficulty, reputationPoints.getPoints(), customersServed, lastRepPointLost);</span>
<span class="pc bpc" id="L331" title="3 of 6 branches missed.">    if (maxCustomers == -1 || (maxCustomers &gt; 0 &amp;&amp; customersGenerated &lt; maxCustomers)) {</span>
<span class="fc" id="L332">      createCustomers(customers, lastCustomer, customersServed, customersGenerated, maxCustomers, difficulty, totalTimer);</span>
    }

<span class="pc bpc" id="L335" title="4 of 6 branches missed.">    if ((customersGenerated == maxCustomers &amp;&amp; customers.size() == 0) || reputationPoints.getPoints() &lt;= 0) {</span>
<span class="nc bnc" id="L336" title="All 2 branches missed.">      game.setScreen(</span>
          new GameWinScreen(
<span class="nc" id="L338">              game, (int) totalTimerDisplay, false, (maxCustomers == -1), isPowerUp, difficulty));</span>
    }

<span class="fc" id="L341">    float increment = powerups.updateValues(delta);</span>

<span class="fc bfc" id="L343" title="All 2 branches covered.">    for (String machine : machines.keySet()) {</span>
<span class="fc" id="L344">      Machine tempMachine = machines.get(machine);</span>
<span class="pc bpc" id="L345" title="1 of 2 branches missed.">      if (tempMachine.getActive()) {</span>
<span class="nc" id="L346">        tempMachine.incrementRuntime(delta);</span>
<span class="nc" id="L347">        tempMachine.attemptGetOutput();</span>
      }
<span class="fc" id="L349">    }</span>

    // Delta is needed to move chefs.
<span class="fc" id="L352">    totalTimerDisplay += increment;</span>
<span class="fc" id="L353">    totalTimer += delta;</span>

<span class="fc" id="L355">    this.save.setChefDetails(chefs, selectedChef);</span>
<span class="fc" id="L356">    this.save.setReputationPoints(reputationPoints.getPoints());</span>
<span class="fc" id="L357">    this.save.setTime(totalTimerDisplay);</span>
<span class="fc" id="L358">    this.save.setRecipe(getFirstCustomer());</span>
<span class="fc" id="L359">    this.save.setTrays(tray1.getList(), tray2.getList());</span>
<span class="fc" id="L360">  }</span>

  /**
   * Attempts to cause an interaction between the currently selected chef and the machine in front
   * of them.
   */
  public void tryInteract() {
<span class="fc" id="L367">    Chef chef = chefs.get(selectedChef);</span>

    int targetx;
    int targety;
<span class="pc bpc" id="L371" title="1 of 5 branches missed.">    switch (chef.getFacing()) {</span>
      case &quot;up&quot;:
<span class="fc" id="L373">        targetx = chef.getxCoord();</span>
<span class="fc" id="L374">        targety = chef.getyCoord() + 1;</span>
<span class="fc" id="L375">        break;</span>
      case &quot;down&quot;:
<span class="fc" id="L377">        targetx = chef.getxCoord();</span>
<span class="fc" id="L378">        targety = chef.getyCoord() - 1;</span>
<span class="fc" id="L379">        break;</span>
      case &quot;left&quot;:
<span class="fc" id="L381">        targetx = chef.getxCoord() - 1;</span>
<span class="fc" id="L382">        targety = chef.getyCoord();</span>
<span class="fc" id="L383">        break;</span>
      case &quot;right&quot;:
<span class="fc" id="L385">        targetx = chef.getxCoord() + 1;</span>
<span class="fc" id="L386">        targety = chef.getyCoord();</span>
<span class="fc" id="L387">        break;</span>
      default:
<span class="nc" id="L389">        targetx = chef.getxCoord();</span>
<span class="nc" id="L390">        targety = chef.getyCoord();</span>
        break;
    }

    // Unlock layer - interactions with any stations that need to be
    // purchased using credits.
<span class="fc" id="L396">    MapObjects unlockObjects = map.getObjectLayers(&quot;Unlock Layer&quot;);</span>

<span class="fc bfc" id="L398" title="All 2 branches covered.">    for (MapObject ob : unlockObjects) {</span>
<span class="pc bpc" id="L399" title="1 of 2 branches missed.">      if (map.detectInteractionFromTiledObject(map.loadRectangle(ob), targetx, targety)) {</span>
<span class="nc" id="L400">        machineUnlockBalance.unlockMachine(ob.getName());</span>
      }
<span class="fc" id="L402">    }</span>

    // Fridge layer - contains all fridges in order to pick up ingredients.
<span class="fc" id="L405">    MapObjects fridgeObjects = map.getObjectLayers(&quot;Fridge Layer&quot;);</span>
<span class="fc bfc" id="L406" title="All 2 branches covered.">    for (MapObject ob : fridgeObjects) {</span>
<span class="fc bfc" id="L407" title="All 2 branches covered.">      if (map.detectInteractionFromTiledObject(map.loadRectangle(ob), targetx, targety)) {</span>
<span class="fc" id="L408">        machines.get(ob.getName()).process(chef, machineUnlockBalance);</span>
<span class="fc" id="L409">        fridge.play(soundVolume);</span>
      }
<span class="fc" id="L411">    }</span>

    // Cooking Objects - contain all machines
<span class="fc" id="L414">    MapObjects cookingObjects = map.getObjectLayers(&quot;Cooking Layer&quot;);</span>

<span class="fc" id="L416">    String invTop = &quot;&quot;;</span>
<span class="fc bfc" id="L417" title="All 2 branches covered.">    if (chef.getInventory().size() != 0) {</span>
      // Work stations
<span class="fc" id="L419">      invTop = chef.getInventory().peek();</span>
    }

<span class="fc bfc" id="L422" title="All 2 branches covered.">    for (MapObject ob : cookingObjects) {</span>
      // Only use a machine if you are trying to interact with it and have the correct
      // input.
<span class="fc bfc" id="L425" title="All 2 branches covered.">      if (map.detectInteractionFromTiledObject(map.loadRectangle(ob), targetx, targety)</span>
<span class="pc bpc" id="L426" title="1 of 2 branches missed.">          &amp;&amp; machines.get(ob.getName()) == chef.getMachineInteractingWith()) {</span>
<span class="nc" id="L427">        machines.get(ob.getName()).attemptCompleteAction();</span>
<span class="fc bfc" id="L428" title="All 2 branches covered.">      } else if (map.detectInteractionFromTiledObject(map.loadRectangle(ob), targetx, targety)</span>
<span class="pc bpc" id="L429" title="1 of 2 branches missed.">          &amp;&amp; chef.getMachineInteractingWith() == null</span>
<span class="fc bfc" id="L430" title="All 2 branches covered.">          &amp;&amp; machines.get(ob.getName()).getInput().equals(invTop)) {</span>
<span class="fc" id="L431">        machines.get(ob.getName()).process(chef, machineUnlockBalance);</span>
      }
<span class="fc" id="L433">    }</span>

<span class="fc" id="L435">    MapObjects miscObjects = map.getObjectLayers(&quot;Misc Layer&quot;);</span>

<span class="fc bfc" id="L437" title="All 2 branches covered.">    if (map.detectInteractionFromTiledObject(</span>
<span class="fc" id="L438">        map.loadRectangle(miscObjects.get(&quot;bin&quot;)), targetx, targety)) {</span>
<span class="pc bpc" id="L439" title="1 of 2 branches missed.">      if (!chef.getInventory().isEmpty()) {</span>
<span class="fc" id="L440">        chef.removeTopFromInventory();</span>
<span class="fc" id="L441">        trash.play(soundVolume);</span>
      }
<span class="pc bpc" id="L443" title="1 of 2 branches missed.">    } else if (map.detectInteractionFromTiledObject(</span>
<span class="fc" id="L444">        map.loadRectangle(miscObjects.get(&quot;serving&quot;)), targetx, targety)) {</span>
<span class="nc" id="L445">      serveFood();</span>
<span class="pc bpc" id="L446" title="1 of 2 branches missed.">    } else if (map.detectInteractionFromTiledObject(</span>
<span class="fc" id="L447">        map.loadRectangle(miscObjects.get(&quot;tray-1&quot;)), targetx, targety)) {</span>
<span class="nc" id="L448">      tray1.addToTray(chefs.get(selectedChef), deliveryStaff, customers, machineUnlockBalance);</span>
<span class="nc" id="L449">      serveFood();</span>
<span class="pc bpc" id="L450" title="1 of 2 branches missed.">    } else if (map.detectInteractionFromTiledObject(</span>
<span class="fc" id="L451">        map.loadRectangle(miscObjects.get(&quot;tray-2&quot;)), targetx, targety)) {</span>
<span class="nc" id="L452">      tray2.addToTray(chefs.get(selectedChef), deliveryStaff, customers, machineUnlockBalance);</span>
<span class="nc" id="L453">      serveFood();</span>
<span class="pc bpc" id="L454" title="1 of 2 branches missed.">    } else if (map.detectInteractionFromTiledObject(</span>
<span class="fc" id="L455">        map.loadRectangle(miscObjects.get(&quot;fast-track-collect&quot;)), targetx, targety)) {</span>
<span class="nc" id="L456">      String item = staffOne.collectItem();</span>
      // Don't add a null pointer onto the chefs stack.
<span class="nc bnc" id="L458" title="All 2 branches missed.">      if (item != null) {</span>
<span class="nc" id="L459">        Machine tempMachine = new Machine(&quot;staff&quot;, item, item, 0, true, &quot;ingredients-staff&quot;);</span>
<span class="nc" id="L460">        tempMachine.processStaffInteraction(chef, machineUnlockBalance);</span>
      }
    }
<span class="fc" id="L463">  }</span>

  /**
   * Getter method for the money class.
   *
   * @return Instance of the money class that is being used within scenario game master.
   */
  public Money getUnlockClass() {
<span class="fc" id="L471">    return machineUnlockBalance;</span>
  }

  /** Method to handle giving food to the customer. */
  public void serveFood() {
<span class="nc bnc" id="L476" title="All 2 branches missed.">    if (customers.isEmpty()) {</span>
<span class="nc" id="L477">      return;</span>
    }
<span class="nc" id="L479">    Chef chef = chefs.get(selectedChef);</span>
    Stack&lt;String&gt; inv;
    // If the order isn't pizza and the server is unlocked,
    // get the order from the staff members inventory.
    // Otherwise, get the chefs inventory and operate
    // from there.
<span class="nc bnc" id="L485" title="All 2 branches missed.">    if (machineUnlockBalance.isUnlocked(&quot;server-staff&quot;)</span>
<span class="nc bnc" id="L486" title="All 2 branches missed.">        &amp;&amp; !(customers.peek().getOrder().equals(&quot;pizza&quot;))) {</span>
<span class="nc" id="L487">      inv = deliveryStaff.getItems();</span>
    } else {
<span class="nc" id="L489">      inv = chef.getInventory();</span>
    }

<span class="nc bnc" id="L492" title="All 2 branches missed.">    if (inv.size() == 0) {</span>
<span class="nc" id="L493">      return;</span>
    }

<span class="nc bnc" id="L496" title="All 2 branches missed.">    if (customers.peek().getOrder().equals(inv.peek())) {</span>
<span class="nc" id="L497">      inv.pop();</span>
<span class="nc" id="L498">      customers.poll();</span>
<span class="nc" id="L499">      customersServed += 1;</span>
<span class="nc" id="L500">      this.save.decrementCustomers();</span>
<span class="nc" id="L501">      serving.play(soundVolume);</span>

<span class="nc bnc" id="L503" title="All 2 branches missed.">      if (customersServed == maxCustomers) {</span>
<span class="nc bnc" id="L504" title="All 2 branches missed.">        game.setScreen(</span>
            new GameWinScreen(
<span class="nc" id="L506">                game, (int) totalTimerDisplay, true, (maxCustomers == -1), isPowerUp, 0));</span>
      }

      // +$100 on completion of a recipe.
<span class="nc" id="L510">      machineUnlockBalance.incrementBalance();</span>
      // Once an order is complete, allow ingredient staff to
      // collect another order.
<span class="nc" id="L513">      staffOne.setGenerate(true);</span>
<span class="nc" id="L514">      this.machineUnlockBalance.saveMoneyDetails(this.save);</span>

      // Activate random power up if a recipe is complete.
<span class="nc bnc" id="L517" title="All 2 branches missed.">      if (isPowerUp) {</span>
<span class="nc" id="L518">        this.powerups.activateRandomPowerUp();</span>
      }
    }
<span class="nc" id="L521">  }</span>

  /**
   * Getter method for the game's PowerUpRunner instance.
   *
   * @return Instance of PowerUpRunner used in the game.
   */
  public PowerUpRunner getPowerUpRunner() {
<span class="fc" id="L529">    return powerups;</span>
  }

  /**
   * Getter method for the game's GameSaver instance.
   *
   * @return Instance of GameSaver used in the game.
   */
  public GameSaver getSave() {
<span class="nc" id="L538">    return save;</span>
  }

  /**
   * Setter method for reputation points.
   *
   * @param reputationPoints Number of reputation points.
   */
  public void setReputationPoints(int overwriteValue) {
<span class="fc" id="L547">    reputationPoints.overwritePoints(overwriteValue);</span>
<span class="fc" id="L548">  }</span>

  /**
   * Setter method for game runtime.
   *
   * @param timeElapsed Amount of time the game has been running.
   */
  public void setTimeElapsed(float timeElapsed) {
<span class="fc" id="L556">    this.totalTimer = timeElapsed;</span>
<span class="fc" id="L557">    this.totalTimerDisplay = timeElapsed;</span>
<span class="fc" id="L558">  }</span>

  /**
   * Getter method for game runtime.
   *
   * @return Amount of time the game has been running.
   */
  public float getTimer() {
<span class="fc" id="L566">    return totalTimerDisplay;</span>
  }

  /**
   * Adds given item to a specified tray. Bypasses order completion checks, only use with
   * GameReader.
   *
   * @param number Number of the tray being added to.
   * @param item Name of item being added to the tray.
   */
  public void addtoTray(int number, String item) {
<span class="pc bpc" id="L577" title="1 of 2 branches missed.">    if (number == 1) {</span>
<span class="fc" id="L578">      tray1.putOnTray(item);</span>
<span class="nc bnc" id="L579" title="All 2 branches missed.">    } else if (number == 2) {</span>
<span class="nc" id="L580">      tray2.putOnTray(item);</span>
    }
<span class="fc" id="L582">  }</span>

  public ArrayList&lt;Chef&gt; getChefs() {
<span class="fc" id="L585">    return chefs;</span>
  }

  public float getTotalTimerDisplay() {
<span class="fc" id="L589">    return totalTimerDisplay;</span>
  }

  public float getTotalTimer() {
<span class="nc" id="L593">    return totalTimer;</span>
  }

  public float getLastRepPointLost() {
<span class="nc" id="L597">    return lastRepPointLost;</span>
  }

  public int getReputationPoints() {
<span class="nc" id="L601">    return reputationPoints.getPoints();</span>
  }

  public Queue&lt;Customer&gt; getCustomers() {
<span class="nc" id="L605">    return customers;</span>
  }

  public ArrayList&lt;String&gt; getTray1() {
<span class="nc" id="L609">    return tray1.getList();</span>
  }

  public ArrayList&lt;String&gt; getTray2() {
<span class="nc" id="L613">    return tray2.getList();</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>